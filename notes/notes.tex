% Created 2021-01-13 mer. 22:12
% Intended LaTeX compiler: pdflatex
\documentclass[11pt]{article}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}

\usepackage[a4paper,bindingoffset=0.5in,%
            left=0.5in,right=0.5in,top=1in,bottom=1in,%
            footskip=.25in]{geometry}

\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{xspace}
\usepackage{commath}
\usepackage{times}
\usepackage{bm} 
\usepackage{balance}
\usepackage{hyperref}
\usepackage{mathtools}
\usepackage{stmaryrd}
\usepackage{wasysym}

\usepackage[toc,page]{appendix}

%%%% Define Acronyms
\usepackage{acronym}
%
\newacro{DF}{distribution fonction}
\newcommand{\DF}{\ac{DF}}
\newcommand{\rs}{\mathrm{s}}
\newcommand{\rt}{\mathrm{t}}
\newcommand{\rr}{\mathrm{r}}
\newcommand{\rx}{\mathrm{x}}
\newcommand{\ry}{\mathrm{y}}
\newcommand{\rz}{\mathrm{z}}
\newcommand{\rc}{\mathrm{c}}
\newcommand{\ro}{\mathrm{o}}

\newcommand{\Eo}{E_{\ro}}

\newcommand{\thr}{\theta_{\rr}}


\newcommand{\psis}{\psi_{\rs}}
\newcommand{\vr}{v_{\rr}}
\newcommand{\vt}{v_{\rt}}
\newcommand{\vx}{v_{\rx}}
\newcommand{\vy}{v_{\ry}}
\newcommand{\vz}{v_{\rz}}
\newcommand{\vinf}{v_{<}}
\newcommand{\vsup}{v_{>}}

\newcommand{\bv}{\boldsymbol{v}}
\newcommand{\bvt}{\boldsymbol{v}_{\mathrm{t}}}
\newcommand{\br}{\boldsymbol{r}}
\newcommand{\hr}{\hat{\br}}
\newcommand{\Fq}{F_{q}}
\newcommand{\fq}{f_{q}}
\newcommand{\ra}{\mathrm{a}}
\newcommand{\va}{v_{\ra}}

\newcommand{\vax}{v_{\ra \rx}}
\newcommand{\vay}{v_{\ra \ry}}
\newcommand{\vaz}{v_{\ra \rz}}

\newcommand{\mH}{\mathbb{H}}
\newcommand{\HG}{\prescript{}{2}F_{1}}

\newcommand{\dvPar}{\Delta v_{||}}
\newcommand{\dvPerp}{\Delta v_{\perp}}

\newcommand{\dvParAvr}{\langle \dvPar \rangle_{\delta t}}
\newcommand{\dvParSqAvr}{\langle(\dvPar)^{2}\rangle_{\delta t}}
\newcommand{\dvPerpSqAvr}{\langle(\dvPerp)^{2}\rangle_{\delta t}}

\newcommand{\dvParAvrLoc}{\langle \dvPar \rangle}
\newcommand{\dvParSqAvrLoc}{\langle(\dvPar)^{2}\rangle}
\newcommand{\dvPerpSqAvrLoc}{\langle(\dvPerp)^{2}\rangle}

\newcommand{\bva}{\boldsymbol{\va}}
\newcommand{\ma}{m_{\ra}}

\newcommand{\e}[1]{\boldsymbol{e_{#1}}}
\newcommand{\bV}[1]{\boldsymbol{V_{#1}}}

\newcommand{\rd}{{\mathrm{d}}}
\newcommand{\var}{v_{\ra \rr}}
\newcommand{\vat}{v_{\ra \rt}}

\newcommand{\vp}{v_{+}}
\newcommand{\vm}{v_{-}}
\newcommand{\bvp}{\boldsymbol{\vp}}
\newcommand{\bvm}{\boldsymbol{\vm}}

\newcommand{\Ea}{E_{\ra}}
\newcommand{\La}{L_{\ra}}

\newcommand{\Vmax}{V_{\max}}

\newcommand{\Dv}{\Delta v}
\newcommand{\DE}{\Delta E}
\newcommand{\DL}{\Delta L}

\newcommand{\DEAvr}{\langle\DE\rangle}
\newcommand{\DESqAvr}{\langle (\DE)^{2} \rangle}
\newcommand{\DLAvr}{\langle\DL\rangle}
\newcommand{\DLSqAvr}{\langle (\DL)^{2} \rangle}
\newcommand{\DEDLAvr}{\langle \DE \DL \rangle}

\newcommand{\dE}{D_{E}}
\newcommand{\dL}{D_{L}}
\newcommand{\dEE}{D_{EE}}
\newcommand{\dLL}{D_{LL}}
\newcommand{\dEL}{D_{EL}}

\newcommand{\DXAvr}{\langle\Delta X\rangle}
\newcommand{\DXYAvr}{\langle\Delta X \Delta Y\rangle}

\newcommand{\dX}{D_{X}}
\newcommand{\dXY}{D_{XY}}

\newcommand{\rmax}{r_{\max}}
\newcommand{\rmin}{r_{\min}}
\newcommand{\rcut}{r_{{\mathrm{cut}}}}
\newcommand{\tcut}{\theta_{{\mathrm{cut}}}}

\newcommand{\psieff}{\psi_{\mathrm{eff}}}
\newcommand{\bL}{\boldsymbol{L}}
\newcommand{\Ec}{E_{{\mathrm{c}}}}
\newcommand{\Lc}{L_{{\mathrm{c}}}}

\newcommand{\bx}{\boldsymbol{x}}
\newcommand{\xp}{x'}
\newcommand{\bxp}{\boldsymbol{\xp}}

\newcommand{\hv}{\hat{\bv}}

\newcommand{\Jr}{J_{\mathrm{r}}}

\newcommand{\bJ}{\boldsymbol{J}}

\newcommand{\xc}{x_{\rc}}
\newcommand{\rrc}{r_{\rc}}

\author{Kerwann}
\date{\today}
\title{Notes}
\hypersetup{
 pdfauthor={Kerwann},
 pdftitle={Notes},
 pdfkeywords={},
 pdfsubject={},
 pdfcreator={Emacs 27.1 (Org mode 9.3)}, 
 pdflang={English}}
\begin{document}

\maketitle

\tableofcontents






\section{Determination of the local diffusion coefficients}
\label{sec:LocDiffCoeffs}

The local diffusion coefficients are the average velocity changes
per unit time. We are interested in computing

\begin{equation}
\begin{array}{ccl}
  \dvParAvrLoc(r,\vr,\vt) & = & \displaystyle{\frac{ \dvParAvr(r,\vr,\vt)}{\delta t}} ,\\
 \dvParSqAvrLoc(r,\vr,\vt) & = & \displaystyle{\frac{ \dvParSqAvr(r,\vr,\vt)}{\delta t}}  ,\\
\dvPerpSqAvrLoc(r,\vr,\vt) & = & \displaystyle{\frac{ \dvPerpSqAvr(r,\vr,\vt)}{\delta t}} ,
\end{array}
\label{eq:DiffCoeffLoc}
\end{equation}

where the subscript are relative to the relative velocity of test star (in the referential where the deflecting field star is still). Consider a test star at position $r$, mass $m$ and initial velocity
$\bv$ which interacts with a field star with impact parameter
$b$, mass $\ma$ and velocity  $\bva$, Binney et Tremaine
(2008, eq. (L.7) page 834) gives , with the convention (here, parallel
and perpendicular to relative velocity)
\begin{equation}
  \Delta\boldsymbol{v}=- \dvPar \e1'+\dvPerp(-\e2'\cos\phi+\e3'\sin\phi) ,
  \label{eq:deltaV}
\end{equation}

where $\e1' \parallel \bV0$ and $\phi$
is the angle between the plane of the relative orbit and $\e2'$,

\begin{equation}
\begin{array}{ccl}
  \dvPerp & =&\displaystyle{\frac{2\ma V_{0}}{m+\ma}\frac{b/b_{90}}{1+b^{2}/b_{90}^{2}}} ,\\
 \dvPar & = & \displaystyle{\frac{2\ma V_{0}}{m+\ma}\frac{1}{1+b^{2}/b_{90}^{2}}} ,
\end{array}
\label{eq:delta_v}
\end{equation}

where $\bV0= \bv-\bva$ and $b_{90}$ is the $90^{\circ}$ deflection radius,
given by eq (L.8) 
\begin{equation}
  b_{90}=\frac{G(m+m_{a})}{V_{0}^{2}} .
  \label{eq:b90}
\end{equation}

Furthermore, after averaging over the equiprobable angles $\phi$
(test star can be on either ``side'' of the field star), we obtain

\begin{equation}
\begin{array}{ccl}
  \langle\Delta v_{i}\rangle_{\phi} & =&-\dvPar \langle\boldsymbol{e_{i}},\e1'\rangle ,\\
  {}&{}&{} \\
  \langle\Delta v_{i}\Delta v_{j}\rangle_{\phi} & = & (\Delta v_{\parallel})^{2}\langle\boldsymbol{e_{i}},\boldsymbol{e_{1}'}\rangle\langle\boldsymbol{e_{j}},\boldsymbol{e_{1}'}\rangle \\
  {}&{}&+\frac{1}{2}(\dvPerp)^{2}\left[\langle\boldsymbol{e_{i}},\e2'\rangle\langle\boldsymbol{e_{j}},\e2'\rangle+\langle\boldsymbol{e_{i}},\e3'\rangle\langle\boldsymbol{e_{j}},\e3'\rangle\right]
\end{array}
\label{eq:delta_v}
\end{equation}

where $(\e1,\e2,\e3)$ is an fixed, arbitrary coordonnate system. Here, note that when considering a test star with energy and angular
momentum (per unit mass) $(E,L)$, using the choise $\vr\geq0$
or the choice $\vr\leq0$ has an impact on the local change of velocity
through $V_{0}$.

We sum the effects of all the encounter up. Number density of field
stars (at position $r$) within velocity space volume ${\rd}^{3}\bva$
is $f(r,\bva) \rd^{3}\bva$ (remember
that $f(r,\bva)= f(r,\var,\vat)$). The number
of encounters in a time $\delta t$ with impact parameters between
$b$ and $b+\rd b$ is just this density times the volume of an
annulus with inner radius $b$, outer radius $b+\rd b$, and length
$V_{0}\delta t$, that is (eq. L9) $2\pi b{\rd}bV_{0}\delta t f(r,\bva){\rm d}^{3}\bva$.

We sum up over the velocities and the impact parameters. For the latter,
we consider impact parameters between $0$ and a cut-off $b_{{\rm max}}$,
traditionally given approximately by the radius of the subject star
orbit.

Recall that $\bV0 =\bv -\bva$.
Since we assume that $\Lambda$ is large, we do not make any significant
additional error by replacing the factor $V_{0}$ in $\Lambda$ by
some typical stellar speed $v_{{\rm typ}}$, that is,

\begin{equation}
  \Lambda=\frac{b_{{\rm max}}v_{{\rm typ}}^{2}}{G(m+\ma)} .
  \label{Lambda}
\end{equation}

This yields (Binney \& Tremaine, eq. L14)

\begin{equation}
\begin{array}{ccl}
  \langle\Delta v_{i}\rangle & =& \displaystyle{-4\pi\frac{\ma}{m+\ma}
    \int{\rd}^{3}\bva V_{0}^{2}b_{90}^{2} f(r,\bva)\ln\Lambda\langle
    \boldsymbol{e_{i}},\e1'\rangle} ,\\
  
  \langle\Delta v_{i}\Delta v_{j}\rangle & = &\displaystyle{ 4\pi\left(
    \frac{\ma}{m+\ma}\right)^{2}\int{\rd}^{3}\bva V_{0}^{3}b_{90}^{2}f(r,
    \bva)\ln\Lambda  \left[\langle\boldsymbol{e_{i}},\e2'\rangle\langle
      \boldsymbol{e_{j}},\e2'\rangle+\langle\boldsymbol{e_{i}},\e3'\rangle
      \langle\boldsymbol{e_{j}},\e3'\rangle\right]}
\end{array}
\label{eq:delta_v_sum}
\end{equation}


where we defined the Coulomb parameter $\Lambda=b_{{\rm max}}/b_{90}$.
Remark that the scalar products depend on $\boldsymbol{v_{a}}$. Take
$\Lambda=\lambda N$ (Binney et Tremaine, page 581) with $N\sim10^{5}$
and $\lambda=0.059$ (Hamilton et al. (2018), eq. (B37)) for a globular
cluster.

Using (Binney \& Tremaine, eq. L17 and L18), we obtain
\begin{equation}
\begin{array}{ccl}
  \langle\Delta v_{i}\rangle(r,\bv) & =&\displaystyle{4\pi G^{2}\ma(m+\ma)\ln\Lambda\frac{\partial h}{\partial v_{i}}(r,\bv)} ,\\
  
  \langle\Delta v_{i}\Delta v_{j}\rangle(r,\bv) & = &\displaystyle{4\pi G^{2}{\ma}^{2}\ln\Lambda\frac{\partial^{2}g}{\partial v_{i}\partial v_{j}}(r,\bv)}
\end{array}
\label{eq:delta_v_Rosenbluth}
\end{equation}
where the Rosenbluth potentials are defined as (Binney \& Tremaine,
eq. L19)
\begin{equation}
\begin{array}{ccl}
  h(r,\bv) & =&\displaystyle{\int{\rd}^{3}\bva\frac{f(r,\bva)}{|\bv-\bva|}} ,\\
  
  g(r,\bv) & = &\displaystyle{\int{\rd}^{3}\bva f(r,\bva)|\bv-\bva|}
\end{array}
\label{eq:Rosenbluth}
\end{equation}


\subsection{Legendre expansion}
\label{subsec:LegendreExpAniso}

Using that the Legendre expansion through its generating function $1/|\bv - \bva| = 1/\sqrt{v^{2}+\va^{2}-2v \va \cos(\theta)}$, we can expand the integration by using $\bv$ as the (Oz) axis as

\begin{equation}
  \begin{array}{ccl}
  h(r,\bv) & =&\displaystyle{\int_{0}^{\infty}{\rd} \va \va^{2} \int_{0}^{\pi} {\rd} \theta \sin \theta \int_{0}^{2\pi}{\rd}\phi \frac{F(\Ea,\La)}{\sqrt{v^{2}+\va^{2}-2v \va \cos(\theta)}}} , \\

  {} & =&\displaystyle{\sum_{l=0}^{\infty}\int_{0}^{\infty}{\rd} \va \va^{2} \frac{\vinf^{l}}{\vsup^{l+1}}\int_{0}^{\pi} {\rd} \theta \sin\theta P_{l}(\cos\theta)  \int_{0}^{2\pi}{\rd}\phi F(\Ea,\La)} , 
  \end{array}
  \label{eq:h_Legendre}
\end{equation}

where $\theta$ is the angle between $\bv$ and $\bva$, $\vinf = \min\{v,\va\}$, $\vsup = \max\{v,\va\}$, $P_{l}$ is the l-th Legendre polynomial and 

\begin{equation}
  \begin{array}{ccl}
    \Ea(r,\va,\theta,\phi) & =&\displaystyle{\psi(r)+\frac{\va^{2}}{2}} , \\

    \La(r,\va,\theta,\phi) &=& \displaystyle{r \vat} .

  \end{array}
  \label{eq:Ea_La_Legendre}
\end{equation}

Letting (Ox) be the projection of $\hr$, the cartesian coordinates of $\va$ and $\hr$ are respectively


$(\va\sin\theta\cos\phi,\va\sin\theta\sin\phi,\va\cos\theta)$ and $(\sin\thr,0,\cos\thr)= (\vt/v,0,\vr/v)$, and we have

\begin{equation}
  \begin{array}{ccl}
    \var(r,\va,\theta,\phi) & =& \bv \cdot \hr = \displaystyle{\frac{\vt\va}{v}\sin\theta\cos\phi  + \frac{\vr\va}{v}\cos\theta} , \\

    \vat^2(r,\va,\theta,\phi) &=& \displaystyle{\va^{2} \left[1 - \left(\frac{\vt}{v}\sin\theta\cos\phi  + \frac{\vr}{v}\cos\theta\right)^{2}\right] } ,

  \end{array}
  \label{eq:var_vat_Legendre}
\end{equation}

and therefore

\begin{equation}
    \La(r,\va,\theta,\phi) = \displaystyle{ r \va \sqrt{1 - \left( \frac{\vr}{v}\cos\theta + \frac{\vt}{v}\sin\theta\cos\phi\right)^{2} }} .
  \label{eq:La_Legendre}
  \end{equation}

\subsection{Anisotropic case}
\label{subsec:Aniso}

Since this result is valid for any arbitrary coordinate system, we
can fix it to the one where $\e1=\hat{v}$ and $\e2$ is the projection
of $\hr$ onto the equatorial plane orthogonal to $\e1$. Then
we'll have the relations
\begin{equation}
\begin{array}{ccl}
  \dvParAvrLoc(r,\bv) & =&\displaystyle{\langle\Delta v_{1}\rangle(r,\bv)} ,\\
  
  \dvParSqAvrLoc(r,\bv) & = &\displaystyle{\langle(\Delta v_{1})^{2}\rangle(r,\bv)}\\
  
  \dvPerpSqAvrLoc(r,\bv) & = &\displaystyle{\langle(\Delta v_{2})^{2}\rangle(r,\bv)+\langle(\Delta v_{3})^{2}\rangle(r,\bv)}
\end{array}
\label{eq:TestStarDeflection}
\end{equation}
where the subscripts are relative of the velocity of the test star.

and a tedious by straightforward computation see appendix) yields

\begin{equation}
  \boxed{
\begin{array}{ccl}
  \dvParAvrLoc(r,\bv) & =&\displaystyle{4\pi G^{2}\ma(m+\ma)\ln\Lambda \bigg( \frac{\vr}{v}\frac{\partial h}{\partial \vr}+\frac{\vt}{v}\frac{\partial h}{\partial \vt} \bigg)} ,\\
  
  \dvParSqAvrLoc(r,\bv) & = &\displaystyle{4\pi G^{2}{\ma}^{2}\ln\Lambda\left(\frac{\vr^{2}}{v^{2}}\frac{\partial^{2}g}{\partial \vr^{2}}+\frac{2\vr\vt}{v^{2}}\frac{\partial^{2}g}{\partial \vt\partial \vr}+\left(\frac{\vt}{v}\right)^{2}\frac{\partial^{2}g}{\partial \vt^{2}}\right)}\\
  
  \dvPerpSqAvrLoc(r,\bv) & = &\displaystyle{4\pi G^{2}\ma^{2}\ln\Lambda\left(\left(\frac{\vt}{v}\right)^{2}\frac{\partial^{2}g}{\partial \vr^{2}}-\frac{2\vr\vt}{v^{2}}\frac{\partial^{2}g}{\partial \vt \partial \vr}+\left(\frac{\vr}{v}\right)^{2}\frac{\partial^{2}g}{\partial \vt^{2}}+\frac{1}{\vt}\frac{\partial g}{\partial \vt}\right)}   
\end{array}
}
\label{eq:AnisoLocDiffCoefsdRdT}
\end{equation}
where $h(r,\bva)=h(r,\vr,\vt)$ and $g(r,\bv)=g(r,\vr,\vt)$.

Applying the change of variable $\bV0=\bv-\bva$
and using spherical coordinates with axis $(Oz)=\hr$
the unit radius vector (parallel or antiparallel to the radial component
of $\bv$ by definition) yields
\begin{equation}
\begin{array}{cclcl}
  h(r,\vr,\vt) & =&\displaystyle{\int{\rd}^{3}\bV0 \frac{f(r,\bv-\bV0)}{V_{0}}} &=& \displaystyle{\int_{0}^{\infty}{\rd}V_{0} V_{0}\int_{0}^{\pi}{\rd}\theta\sin\theta\int_{0}^{2\pi}{\rd}\phi f(r,\bv-\bV0)} ,\\
  
  g(r,\vr,\vt) & = &\displaystyle{\int{\rd}^{3}\bV0 f(r,\bv-\bV0)V_{0}} &=& \displaystyle{\int_{0}^{\infty}{\rd}V_{0} V_{0}^{3}\int_{0}^{\pi}{\rd}\theta\sin\theta\int_{0}^{2\pi}{\rd}\phi f(r,\bv-\bV0)}
\end{array}
\label{eq:Rosenbluth}
\end{equation}
where
\begin{equation}
  f(r,\bv-\bV0)=f(r,\var,\vat)=F(E(r,\var,\vat),L(r,\var,\vat))
  \label{eq:DFa}
\end{equation}

with $E,L$ given by eq \eqref{eq:v_to_E_L}.

For a given convention $+$ or $-$ of the choice of $\vr$, and
given $(E,L)$ the parameters of the test star, obtain the vectors
$\bvp=(|\vr|,\bvt)$ and $\bvm=(-|\vr|,\bvt)$,
which are symmetric with respect to the tangent plane where $\bvt$
lives. In terms of spherical coordinates, we have that $\bvp=(v,\theta_{0},0)$
and $\bvm=(v,\pi-\theta_{0},0)$. Remember that the
integration over the velocities $\bV0=\bv-\bva$ of
the field stars cover the whole $\boldsymbol{V_{0}}$-space. Given
a velocity $\bV0$ corresponds bijectively a field star
velocity $\bva$. The overall integration will in fact not depend on the convention we used. The $E(r,\var,\vat)$ component depends on the sign of $\vr$ since
\begin{equation}
  \Ea(r,V_{0},\theta,\phi)=\psi(r)+\frac{1}{2}\left[v^{2}+V_{0}^{2}-2V_{0}(\vr\cos\theta+\vt\sin\theta\cos\phi)\right]
  \label{eq:Ea}
\end{equation}

but $\La(r,\var,\vat)$ does not. When doing the integration, we will evaluate the integrand at both arguments $(V_{0},\theta,\phi)$ and  $(V_{0},\pi-\theta,\phi)$, and their summed contribution doesn't depend on the convention choice. In the following, we decide to use $\vr\geq 0$.

For an actual computation, we also
need to compute the various velocity-partial derivatives of those
integrals, meaning that we need to compute the velocity-partial derivatives
of $f(r,\bva)=F(\Ea,\La)$ (exchange
derivation and integral). Those are (function are evaluated at $(\Ea,\La)$)

\begin{equation}
  \boxed{
\begin{array}{ccl}
  \displaystyle{\frac{\partial}{\partial \vr}\left[f(r,\bv-\bV0)\right]} & =&\displaystyle{\left(-\vr+V_{0}\cos\theta\right)\frac{\partial F}{\partial E}} ,\\
  
   \displaystyle{\frac{\partial}{\partial \vt}\left[f(r,\bv-\bV0)\right]} & =&\displaystyle{\left(-\vt+V_{0}\sin\theta\cos\phi\right)\left(\frac{\partial F}{\partial E}-\frac{r}{\La}\frac{\partial F}{\partial L}\right)} ,\\
 
  \displaystyle{\frac{\partial^{2}}{\partial \vr^{2}}\left[f(r,\bv-\bV0)\right]} & =&\displaystyle{-\frac{\partial F}{\partial E}+\left(-\vr+V_{0}\cos\theta\right)^{2}\frac{\partial^{2}F}{\partial E{}^{2}}} ,\\
 
  \displaystyle{\frac{\partial^{2}}{\partial \vt\partial \vr}\left[f(r,\bv-\bV0)\right]} & =&\displaystyle{\left(-\vr+V_{0}\cos\theta\right)\left(-\vt+V_{0}\sin\theta\cos\phi\right)\left(\frac{\partial^{2}F}{\partial E{}^{2}}-\frac{r}{\La}\frac{\partial^{2}F}{\partial L\partial E}\right)} ,\\
 
  \displaystyle{\frac{\partial^{2}}{\partial \vt^{2}}\left[f(r,\bv-\bV0)\right]} & =&\displaystyle{-\frac{\partial F}{\partial E}+\frac{r}{\La}\frac{\partial F}{\partial L}+\left(-\vt+V_{0}\sin\theta\cos\phi\right)^{2}} \\
  {}&\times& \displaystyle{\left(\frac{\partial^{2}F}{\partial E{}^{2}}-\frac{2r}{\La}\frac{\partial^{2}F}{\partial L\partial E}-\frac{r^{2}}{\La^{3}}\frac{\partial F}{\partial L}+\frac{r^{2}}{\La^{2}}\frac{\partial^{2}F}{\partial L{}^{2}}\right)} .
\end{array}
}
\label{eq:DF_Derivatives}
\end{equation}

The DF and its derivative vanish when $\Ea>0$. Obviously, $\va(r,V_{0},\theta,\phi)$ is minored by the polynomial in $V_{0}$ given by $v^{2}+V_{0}^{2}-2V_{0}(\vr+\vt)$. We have $\Ea>0$ when $\va>-\psi(r)$, which happens outside of the roots of $v^{2}+V_{0}^{2}-2V_{0}(\vr+\vt)+2\psi(r)$. Those roots are

\begin{equation}
  V_{0 \pm} = (\vt+\vr)\pm\sqrt{2(\vr\vt-\psi(r))}.
  \label{eq:Vmax}
\end{equation}
For $E>0$, the inferior root is always negative whereas the superior root is always positive. Let's call it $\Vmax$. In the end, the Rosenbluth potentials can be computed over compact domains
\begin{equation}
  \boxed{
\begin{array}{ccl}
  h(r,\vr,\vt) &=& \displaystyle{\int_{0}^{\Vmax}{\rd}V_{0} V_{0}\int_{0}^{\pi}{\rd}\theta\sin\theta\int_{0}^{2\pi}{\rd}\phi f(r,\bv-\bV0)} ,\\
  g(r,\vr,\vt) &=& \displaystyle{\int_{0}^{\Vmax}{\rd}V_{0} V_{0}^{3}\int_{0}^{\pi}{\rd}\theta\sin\theta\int_{0}^{2\pi}{\rd}\phi f(r,\bv-\bV0)}
\end{array}
}
\label{eq:Rosenbluth_finite}
\end{equation}
and so do its partial derivatives.

\subsection{Isotropic case}
\label{subsec:Isotropic}

We may want to check that the integrals yield the correct result.
To that end, it can be of interest to consider the simple case $q=0$,
where $F(E,L)=F(E)$, i.e. $f(r,\bv)=f(r,v)=F(E)$.
Then according Binney \& Tremaine, eq. (L26),

\begin{equation}
\begin{array}{ccl}
  \dvParAvrLoc(r,v) & =&\displaystyle{-\frac{16\pi^{2}G^{2}\ma(m+\ma)\ln\Lambda}{v^{2}}K_{1}(r,v)} ,\\
  
  \dvParSqAvrLoc(r,v) & = &\displaystyle{\frac{32\pi^{2}G^{2}\ma^{2}\ln\Lambda}{3}\left(K_{0}(r,v)+\frac{1}{v^{3}}K_{3}(r,v)\right)}\\
  
  \dvPerpSqAvrLoc(r,v) & = &\displaystyle{\frac{32\pi^{2}G^{2}\ma^{2}\ln\Lambda}{3}\left(2K_{0}(r,v)+\frac{3}{v}K_{1}(r,v)-\frac{1}{v^{3}}K_{3}(r,v)\right)}   
\end{array}
\label{eq:IsoLocDiffCoefsdRdT}
\end{equation}

where
\begin{equation}
\begin{array}{ccl}
 K_{0}(r,v) & =&\displaystyle{\int_{0}^{E}{\rm d}E_{a}F(E_{a})} ,\\
  
  K_{1}(r,v) & = &\displaystyle{\int_{E}^{\psi(r)}{\rm d}E_{a}v_{a}F(E_{a})}\\
  
  K_{3}(r,v) & = &\displaystyle{\int_{E}^{\psi(r)}{\rm d}E_{a}v_{a}^{3}F(E_{a})}   
\end{array}
\label{eq:K_Iso}
\end{equation}
and the correspondance $E = \psi(r)-v^{2}/2$

In the appendix, we recompute the formulae of the isotropic case from
the arbitrary anisotropic case, with $v^{2}=\vr^{2}+\vt^{2}$,
$h(r,\vr,\vt)=h(r,v)$ and $g(r,\vr,\vt)=g(r,v)$.

\section{Local orbital parameter changes}
\label{sec:Local_dE_dL}

Now, switch to $(E,L)$ space and using eq. (C15) to (C19) of Bar-Or
\& Alexander (2016), which doesn't rely on an isotropy assumption,
we obtain (evaluate at $(r,\bv(r,E,L))$) at first order
in $\Dv/v$

\begin{equation}
\begin{array}{ccl}
 \DEAvr(r,E,L) & =&\displaystyle{\frac{1}{2}\dvParSqAvrLoc+\frac{1}{2}\dvPerpSqAvrLoc+v\dvParAvrLoc} ,\\
  
 \DESqAvr(r,E,L) & = &\displaystyle{v^{2}\dvParSqAvrLoc}\\
  \DLAvr(r,E,L) & =&\displaystyle{\frac{L}{v}\dvParAvrLoc+\frac{r^{2}}{4L}\dvPerpSqAvrLoc} ,\\
  
  \DLSqAvr(r,E,L) & = &\displaystyle{\frac{L^{2}}{v^{2}}\dvParAvrLoc+\frac{1}{2}\left(r^{2}-\frac{L^{2}}{v^{2}}\right)\dvPerpSqAvrLoc}\\
  
  \DEDLAvr(r,E,L) & = &\displaystyle{L \dvParSqAvrLoc}   
\end{array}
\label{eq:DE_DL}
\end{equation}
Due to our analysis, those quantities are well defined and
we can use the bijective transformation $(r,E,L)\leftrightarrow(r,\vr,\vt)$

\section{Orbit of a test star in a globular cluster}
\label{sec:Orbit_globular_cluster}

We can now compute the local diffusion coefficients $\DEAvr$,
$\DESqAvr$, $\DLAvr$,
$\DLSqAvr$ and $\DEDLAvr$.
Since we are interested in the secular evolution of the system, we
can average over the dynamical time and smear out the star along its
orbit. This leads us to consider the orbit-average diffusion coefficients

\begin{equation}
\begin{array}{cclcl}
 \dX(E,L) & =& \DXAvr_{\leftturn} & =&\displaystyle{\frac{2}{T}\int_{\rmin}^{\rmax}\DXAvr(r,E,L)\frac{{\rd}r}{\vr(r,E,L)}} ,\\
  
  \dXY(E,L) & =& \DXYAvr_{\leftturn} & =&\displaystyle{\frac{2}{T}\int_{\rmin}^{\rmax}\DXYAvr(r,E,L)\frac{{\rd}r}{\vr(r,E,L)}} .
\end{array}
\label{eq:DE_DL}
\end{equation}
where $\vr(r)$ is the radial velocity of the orbiting star at $r$. It is of interest to define the effective potential

\begin{equation}
  \psieff(r,L) = \psi(r) + \frac{L^{2}}{2r^{2}} .
  \label{eq:Effective_potential}
  \end{equation}

\subsection{Study of an orbit}
\label{subsec:OrbitGlobular}

See Kurth (1955), Astronomische Nachrichten, volume 282, Issue
6, p.241.

~

Consider a test star described by its position vector $\br$,
its energy  $E(t)$ and its angular
momentum vector $\bL(t)$, per unit mass. Then by Newton's law, those two quantities are conserved along an orbit, allowing us to drop the $t$ parameter.

Consider a bound orbit with $E\leq 0$ and $L \geq 0$. Then its ascending radial velocity is given by

\begin{equation}
  \vr(r) = \sqrt{2(E-\psieff(r;L))} ,
  \label{eq:radial_velocity}
\end{equation}

its bounds $\rmin$ and $\rmax$ are given by the solution of the equation $\vr(r)=0$, which has two solutions, and its orbital period $T$ is defined by

\begin{equation}
 \frac{T}{2}=\int_{\rmin}^{\rmax}\frac{{\rd}r}{\vr(r)} .
  \label{eq:orbital_period}
  \end{equation}

The ''type'' of an orbit is determined by $E$ and $L$. Graphically, $\rmax$ and $\rmin$ are given by the intersection points of $\psieff(r,L)$ and $E$. There are a few different cases:
\begin{itemize}
\item $E \geq 0$: unbounded orbit,
\item $E \in ]\Ec(L),0[$: bound ''rosette-like'' orbit,
\item $E = \Ec(L)$: circular orbit,
\item $E < \Ec(L)$: impossible,
\end{itemize}
where $\Ec(L) = \min_{r>0}\psieff(r,L)$.

All the integral are finite, since they are integrable at the endpoints

\begin{equation}
\begin{array}{ccl}
 \displaystyle{\frac{1}{\vr(\rmax-\epsilon)}} & \sim& \displaystyle{|2\psi_{{\rm eff}}'(r_{\max})|^{-1/2}\frac{1}{\sqrt{\epsilon}}} ,\\
  
 \displaystyle{\frac{1}{\vr(\rmin+\epsilon)}} & \sim&\displaystyle{|2\psi_{{\rm eff}}'(r_{\min})|^{-1/2}\frac{1}{\sqrt{\epsilon}}} .
\end{array}
\label{eq:integrable_T}
\end{equation}
with strictly positive prefactor for bounded, non-circular orbits.



\subsection{Circular orbit}
\label{subsec:Circular_Energy}

 The allowed region in $(E,L)$ space is composed of the
$E < 0 , L> 0$ such that there exists $r>0$ verifying the inequality
$\psieff(r;L)\leq E$. For $L>0$, this function  is decreasing until a global
minimum before increasing towards $0$. Raising the value of $L$
increases this minimum value, meaning that there exists a value $\Lc(E)$
such that $\psieff(r;\Lc(E))=E$. Then, the forbidden angular
momenta (for a given $E$) are the $L>\Lc(E)$. Due to the
discussion in the previous section, this couple $(E,\Lc(E))$
determines a circular orbit.


\subsubsection{Plummer model}
\label{subsubsec:PlummerCircularOrbit}

(TODO)

It is given by $\Ec(L)=\min_{r>0}\psieff(r;L)=\psieff(r_{*}^{L};L)$.
To approximate this $r_{*}^{L}$, we may look for it using Newton's
method applied to $\psieff'$, since $\psieff'(r_{*}^{L};L)=0$.
Start at $r_{0}^{L}=L^{2/3}$ , where the evaluation yields
\begin{equation}
\psieff'(L^{2/3};L)=-1+\frac{L^{2/3}}{(1+L^{4/3})^{3/2}}\in[-1,\sqrt{4/27}-1]\simeq[-1,-0.615]
\label{eq:start_recursion_Ec}
\end{equation}
in order not to be too far away from $\psieff'(r_{*}^{L};L)=0$,
and apply the recursion
\begin{equation}
r_{n+1}^{L}=r_{n}^{L}-\frac{\psi'_{{\rm eff}}(r_{n}^{L};L)}{\psi''_{{\rm eff}}(r_{n}^{L};L)},
\label{eq:recursion_Ec}
\end{equation}
where

\begin{equation}
\begin{array}{ccl}
 \psieff'(r;L) & =& \displaystyle{\frac{r}{(1+r^{2})^{3/2}}-\frac{L^{2}}{r^{3}}} ,\\
  
  \psieff''(r_{n};L) & =&\displaystyle{\frac{(1+r^{2})^{3/2}-3r^{2}\sqrt{1+r^{2}}}{(1+r^{2})^{3}}+3\frac{L^{2}}{r^{4}}} .
\end{array}
\label{eq:psieff_derivatives}
\end{equation}

Then $r_{n}^{L}\rightarrow r_{*}^{L}$. We can show that $(r_{n}^{L})$
is increasing since $\psieff'(r_{n}^{L};L)<0$ and $\psieff''(r_{n}^{L};L)>0$
(and convexity of $\psieff'$ where it matters). Therefore
a good stopping condition is to get the lowest $N$ such that $\psieff'(r_{N}^{L}+\epsilon)>0$
for some precision $\epsilon>0$. Then, taking $\tilde{r}_{*}^{L}=(r_{N}^{L}+r_{N}^{L}+\epsilon)/2=r_{N}^{L}+\epsilon/2$
we will have $\Ec(L)\simeq\psieff(\tilde{r}_{*}^{L};L)$,
with precision 
\begin{equation}
\delta \Ec(L)\simeq|\psieff(r_{*}^{L};L)-\psieff(\tilde{r}_{*}^{L};L)|\simeq\frac{1}{2}|\underbrace{\psieff^{(2)}(r_{*}^{L})}_{>0}|\cdot|r_{*}^{L}-\tilde{r}_{*}^{L}|^{2}\simeq|\psieff^{(2)}(r_{*}^{L})|\frac{\epsilon^{2}}{8}
\label{eq:precision_Ec}
\end{equation}

However, there is no need to use an approximation method to compute $\Lc$, as we can obtain an analytical formula. Indeed, it is given by
\begin{equation}
\Lc^{2}(E)=\eta(r_{*}^{E};E)=\max_{r>0}\eta(r;E).
\label{eq:angular_circular}
\end{equation}
where we defined $\eta(r;E)\doteqdot 2 r^{2}(E-\psi(r))$. Using the change of variable $x=2r^{2}$, we obtain $\tilde{\eta}(x,L)=\eta(r,L)=x(E+1/\sqrt{1+x/2})$, whose maximum is equal to that of $\eta$. It is reached for $\xc(E)$ (defined in the next section), whose computation is done is the appendix and is given by eq\eqref{eq:xcPlummer}. Therefore, we have an analytical expression for $\Lc^{2}(E)$, given by

\begin{equation}
  \Lc^{2}(E) =\tilde{\eta}(\xc(E),E) =\eta(\sqrt{\xc(E)/2},E) .
  \label{eq:Lc_analytical_Plummer}
  \end{equation}

Though in fact, we could obtain an analytical expression for $\Ec(L)$. Using the same change of variable $x=2r^{2}$, the condition $\psieff'(r;L)=0$ is equivalent to the degree-4 polynomial equation $x^{4}-2L^{4}(x+2)^{3}=0$. Using Ferrari's method, we can obtain the expression of its roots with respect to $L$. There isn't really a need to do that, as we won't explicitely need to compute $\Ec(L)$.

\subsubsection{Isochrone model}
\label{subsubsec:IsoCircularOrbit}

In this case, $\psieff(r,L)=-2/(1+\sqrt{1+r^{2}}) + L^{2}/(2r^{2})$. Its minimum value is given by

\begin{equation}
  \Ec(L) = \frac{1}{4} \bigg(-L^{2} + \sqrt{L^{2}(L^{2}+8)}-4\bigg).
  \label{eq:Ec_Isochronous}
\end{equation}

As for $\Lc^{2}$, we can deduces its expressions by inverting eq.\eqref{eq:Ec_Isochronous}. Letting $X=L^{2}$, we must solve for $X>0$ the equation

\begin{equation}
  4E=-X+\sqrt{X(X+8)}-4 = h(X) ,
  \label{eq:Lc2X}
\end{equation}
which is an increasing function such that $h(0)=-4$ and $h(+\infty)=0$. Therefore it has only one strictly positive solution. We can rewrite this equation as the degree-2 equation
\begin{equation}
  (4(E+1)+X)^{2}=X(X+8) ,
  \label{eq:Lc2X_poly2_equation}
\end{equation}
which simplifies a linear equation with the solution $X=-2(E+1)^{2}/E>0$. Therefore, the angular momentum of a circular orbit for the isochronous potential is given by

\begin{equation}
  \Lc(E) = \sqrt{\frac{2(E+1)^{2}}{-E}} .
  \label{eq:Ec_Iso}
  \end{equation}


\subsubsection{Plummer model}
\label{subsubsec:PlummerOrbitStudy}

We need to compute orbit-averaged quantities of the form

\begin{equation}
  I(D) = \int_{\rmin}^{\rmax}  \frac{D(r)\rd r}{\vr(r)} ,
  \label{eq:I(D)} 
\end{equation}

where $\vr(r)=\sqrt{2(E-\psi(r))-L^{2}/r^{2}}$. Letting $x=2r^{2}$ and $Y(x)=2r^{2}\psi(r)$ gives
\begin{equation}
  I(D) = \frac{1}{4}\int_{x_{\min}}^{x_{\max}}  \frac{D(r(x))\rd x}{\sqrt{E x - Y(x) -L^{2}}} .
  \label{eq:I(D)ChgX}
\end{equation}

Defining $\ell^{2} = \Lc^{2}(E)-L^{2}$ and $z^{2}=Y(x)-(E x - \Lc^{2})$, we have

\begin{equation}
 I(D) = \frac{1}{4}\int_{x_{\min}}^{x_{\max}}  \frac{D(r(x))\rd x}{\sqrt{\ell^{2}-z^{2}(x)}} .
  \label{eq:I(D)ChgX_Z}
\end{equation}

The equation  $z^{2}=Y(x)-(E x - \Lc^{2})$ has two solutions in $[0,\xc]$ (for $(z<0)$) and $[\xc,+\infty[$ (for $z>0$). This defines a function $x=\varphi(z)$, which is $C^{1}$ and strictly increasing with $\varphi(0)=\xc$ and is always strictly positive. This change of variable gives

\begin{equation}
 I(D) = \frac{1}{4}\int_{-\ell}^{\ell}  \frac{D(r(z))\varphi'(z)\rd z}{\sqrt{\ell^{2}-z^{2}}} .
 \label{eq:I(D)Chgz}
\end{equation}

A last variable of variable $z=\ell\sin\phi$ gives
\begin{equation}
I(D) = \frac{1}{4}\int_{-\pi/2}^{\pi/2}  D(r(\phi))\varphi'(\ell\sin\phi)\rd \phi ,
\label{eq:I(D)Chgphi}
\end{equation}

where $r(\phi)=\sqrt{\varphi(\ell\sin\phi)/2}$. Computations given in the appendix gives the following. Define the function $\Upsilon(x)=z^{2}(x)=Y(x)-(E x-\Lc^{2})$. Then

\begin{equation}
  z(x)=\begin{cases}
\displaystyle{ -\sqrt{\Upsilon(x)}} & {\rm{if}} \quad x\leq\xc ,\\
\displaystyle{ +\sqrt{\Upsilon(x)}} &{\rm{if}} \quad x\geq\xc .
\end{cases}
  \label{eq:z(x)}
\end{equation}

Since $z^{2}=\Upsilon(\varphi(z))$, we have that
\begin{equation}
\varphi'(z) = \frac{2 z}{\Upsilon'(\varphi(z))} ,
  \label{eq:varphi'(z)}
\end{equation}

which is strictly positive for $z\neq0$ and evaluates to $\sqrt{2/\Upsilon''(\xc)}>0$ at $z=0$ (see appendix). A straighforward computation gives us that $x=\varphi(z)$ is solution to the degree-3 polynomial equation $z^{2}-\Lc^{2} + Ex)^{2}(1+x/2)=x^{2}$. This equation has at least the two real-positive solutions of $z^{2}=\Upsilon(x)$, to which it must have an additional root at some negative $x$. Cardan's formulae (and more precisely Viète's formulae) gives us analytical expressions for those solutions (in terms of its coefficients), hence analytical expressions in term of $z$. Using equation \eqref{eq:varphi'(z)}, we obtain an analytical expression of $\varphi'(z)$ which is regular along $z$, meaning that the orbit-averaged expression from eq. \eqref{eq:I(D)Chgphi} is nicely integrable.

In particular, we obtain the following expressions

\begin{equation}
  \boxed{
    \begin{array}{ccl}
      \displaystyle{\frac{T}{2}} &=& \displaystyle{\int_{-\pi/2}^{\pi/2}\varphi'(\ell\sin\phi)\rd \phi},\\
      \displaystyle{\langle D\rangle} &=& \displaystyle{\frac{2}{T}\int_{-\pi/2}^{\pi/2}D(r(\phi))\varphi'(\ell\sin\phi)\rd \phi}, \\
      r(\phi) &=& \sqrt{\varphi(\ell\sin\phi)/2}.
    \end{array}
  }
  \label{eq:periodAndOAD}
 \end{equation}

A few things to highlight:
\begin{itemize}
\item Effective anomaly:
  \begin{equation}
  \phi(r)=\begin{cases}
\displaystyle{ -\arcsin(\Upsilon(2r^{2})/\ell)} & {\rm{if}} \quad r\leq\rrc ,\\
\displaystyle{ +\arcsin(\Upsilon(2r^{2})/\ell)} &{\rm{if}} \quad r\geq\rrc ,
  \end{cases}
  \label{eq:effective_anomaly}
  \end{equation}
  
\item Radius w.r.t. effective anomaly:
  \begin{equation}
 r(\phi)=\sqrt{\varphi(\ell\sin\phi)/2} ,
  \label{eq:r(effective_anomaly)}
  \end{equation}
  
\item Gradient of radius:
  \begin{equation}
 r'(\phi)=\frac{\ell\cos\phi\varphi'(\ell\sin\phi)}{4\sqrt{\varphi(\ell\sin\phi)/2}} ,
  \label{eq:Gradient_r(effective_anomaly)}
  \end{equation}
  
\item Stable integrand:
  \begin{equation}
 \frac{r'(\phi)}{\vr(\phi)}=\varphi'(\ell\sin\phi) .
  \label{eq:Gradient_r(effective_anomaly)_over_vr}
  \end{equation}
\end{itemize}

All of those expression are analytical, without singularities and well-defined over their compact domain of definition.

\subsubsection{Isochrone model}
\label{subsubsec:IsochroneOrbitStudy}

(TODO)

\section{Diffusion equation and change of variables}
\label{sec:diffEq_changeVar}

All in all, those coefficients appear in the Fokker-Planck diffusion
equation
\begin{equation}
\frac{\partial P}{\partial t}(E,L,t)=-\frac{\partial}{\partial E}\left[\dE P\right]+\frac{1}{2}\frac{\partial^{2}}{\partial E^{2}}\left[\dEE P\right]-\frac{\partial}{\partial L}\left[\dL P\right]+\frac{1}{2}\frac{\partial^{2}}{\partial L^{2}}\left[\dLL P\right]+\frac{1}{2}\frac{\partial^{2}}{\partial E\partial L}\left[\dEL P\right]
\label{eq:FP:equation}
\end{equation}

If we want to change coordinates $\bx\rightarrow\bxp(\bx)$,
we may use the formulae (C.52) and (C.53) p.25 from Bar-Or \& Alexander
(2016)
\begin{equation}
\begin{array}{ccl}
  D'_{l} & =& \displaystyle{\frac{\partial \xp_{l}}{\partial x_{k}}D_{k}+\frac{1}{2}\frac{\partial^{2}\xp_{l}}{\partial x_{r}\partial x_{k}}D_{rk}} ,\\
  
 D'_{lm} & =&\displaystyle{\frac{\partial \xp_{l}}{\partial x_{r}}\frac{\partial \xp_{m}}{\partial x_{k}}D_{rk}} .
\end{array}
\label{eq:change_var_DiffCoeffs}
\end{equation}


(error on the sign? should be
\[
D'_{l}=\frac{\partial \xp_{l}}{\partial x_{k}}D_{k}-\frac{1}{2}\frac{\partial^{2}\xp_{l}}{\partial x_{r}\partial x_{k}}D_{rk}\quad?)
\]

Instead of considering the parameters $(E,L)$, we could go to the action parameters $(\Jr,L)$ with $\Jr$ being the radial action. It is defined as

\begin{equation}
  \Jr(E,L) = \frac{1}{\pi} \int_{\rmin(E,L)}^{\rmax(E,L)}\vr(r,E,L)\rd r =  \frac{1}{\pi} \int_{\rmin(E,L)}^{\rmax(E,L)} \sqrt{2(\psieff(r,L)-E)}\rd r.
  \label{eq:Radial_action}
  \end{equation}

It is the generating function of the radial period $T$ defined in eq \eqref{eq:orbital_period} and of the apsidal angle $\Theta$ defined by  $\Theta(t)=\theta(t+T)-\theta(t)$, which is constant and given by the formula

\begin{equation}
  \Theta(E,L)=   \int_{\rmin(E,L)}^{\rmax(E,L)} \frac{2 L \rd r}{r^{2}\vr(r,E,L)} =   \int_{\rmin(E,L)}^{\rmax(E,L)} \frac{2 L \rd r}{r^{2}\sqrt{2(\psieff(r,L)-E)}}, 
  \label{eq:Apsidal_angle}
\end{equation}

with $\theta(t) = p(t) + \Theta t/T$ with $p(t)$ is $T$-periodical.
Those quantities are linked by the relations  (see appendix)

\begin{equation}
  \frac{T}{2\pi} = -\frac{\partial \Jr}{\partial E}\quad \mathrm{and} \quad
  \frac{\Theta}{2\pi} = -\frac{\partial \Jr}{\partial L}
  \label{eq:dJr}
\end{equation}

The transformation $(E,L) \rightarrow (\Jr,L)$ yields (check that the relation is correct?)

\section{Plummer model}
\label{sec:Plummer}

  Consider a Plummer model (Dejonghe, H.1987, MNRAS 224, 13) with potential
with units $r_{\rs}$ the Plummer scale radius (which sets the size
of the cluster core), $M$ the total mass of the cluster and $\bar{\tau}$
some unit time. Let $\psis$ be defined by
\begin{equation}
\psis = \frac{G M}{r_{\rs}} ,
\label{eq:def_psi_s}
\end{equation}

for the central potential
\begin{equation}
\psi(r)=-\frac{\psis}{\sqrt{1+r^{2}}} .
\label{eq:def_potential}
\end{equation}

Let use fix $G=1\,r_{\rs}^{3}.M^{-1}.{\rm \bar{\tau}^{-2}}$ in the
new units so that $\psis=1\,r_{\rs}^{2}\cdot\bar{\tau}^{-2}$. This
fixes the time unit $\bar{\tau}$, as we have the relation. Therefore, in
those units the potential (per unit mass) is given by
\begin{equation}
\psi(r)=-\frac{1}{\sqrt{1+r^{2}}} .
\label{eq:def_potential_new_units}
\end{equation}

Define, given a radius $r$, the angular momentum $L(r,\vr,\vt)$
and energy per unit mass $E(r,\vr,\vt)$, functions of
the radial velocity $\vr$ and the tangential velocity $\vt\geq 0$
(defined as $\bv=\vr \hr + \bvt$),
as
\begin{equation}
\begin{array}{ccl}
E(r,\vr,\vt) & = & \psi(r)+\frac{1}{2} \vr^{2}+\frac{1}{2}\vt^{2} ,\\
L(r,\vr,\vt) & = & r \cdot \vt ,
\end{array}
\label{eq:v_to_E_L}
\end{equation}

whose Jacobian is
\begin{equation}
{\rm Jac}_{(r,\vr,\vt)\rightarrow(r,E,L)}=\left(\begin{array}{cc}
\displaystyle{\frac{\partial E}{\partial \vr}} & \displaystyle{\frac{\partial E}{\partial \vt}}\\
\displaystyle{\frac{\partial L}{\partial \vr}} & \displaystyle{\frac{\partial L}{\partial \vt}}
\end{array}\right)=\left(\begin{array}{cc}
\vr & \vt\\
0 & r
\end{array}\right)\Rightarrow|{\rm Jac}|=r|\vr| .
\label{eq:Jacobian}
  \end{equation}

To obtain a bijective transformation, we must chose whether to chose
$\vr\ge 0$ or $\vr\leq 0$. A priori, this choice might have an
impact on the result, but we will should that the local and orbit-averaged
diffusion coefficients are not that. The coordinate system is spherical,
its origin being at the center of the globular cluster. Finally, we
consider the corresponding anisotropic distribution functions of the
field stars $\Fq(r,E,L)= \Fq(E,L)$ in $(E,L)$-space. Since $(E,L)$
and $(\vr,\vt)$ are linked, we can make use of the following
equalities (for the moment, $\vr$ is defined modulo the sign)
\begin{equation}
\begin{array}{ccl}
\Fq(E,L) &=&\displaystyle{\fq(r,\vr(r,E,L),\vt(r,E,L))} ,\\
\fq(r,\vr,\vt)&=&\displaystyle{F_{q}(E(r,\vr,\vt),L(r,\vr,\vt))} ,
\end{array}
\label{eq:conversion_DF}
\end{equation}

where $\fq$ is the \DF in the $(\vr,\vt)$ space and where $q$ is an anisotropy
parameter:
\begin{itemize}
\item $q\in]0,2]$: radially anisotropic
\item $q=0$: isotropic
\item $q\in]-\infty,0[$: tangentially anisotropic.
\end{itemize}

Note that the DF has spherical symmetry in position. Its expression for $-E \geq 0, L \geq 0$
is (for $q \neq0$):
\begin{equation}
  \Fq(E,L)=\frac{3\Gamma(6-q)}{2(2\pi)^{5/2}\Gamma(q/2)}(-E)^{7/2-q}\mH(0,\frac{q}{2},\frac{9}{2}-q,1;-\frac{L^{2}}{2E})
  \label{eq:def_Fq}
\end{equation}
where
\begin{equation}
\mH(a,b,c,d;x)=\begin{cases}
\displaystyle{\frac{\Gamma(a+b)}{\Gamma(c-a)\Gamma(a+d)}x^{a} \HG(a+b,1+a-c,a+d;x)} & {\rm{if}} \quad x\leq1 ,\\
\displaystyle{\frac{\Gamma(a+b)}{\Gamma(d-b)\Gamma(b+c)}x^{-b} \HG(a+b,1+b-d,b+c;\frac{1}{x})} &{\rm{if}} \quad x\geq1 ,
\end{cases}
\label{eq:def_H}
\end{equation}
which reduces in the isotropic case $(q=0)$ to
\begin{equation}
  F_{0}(E)=\frac{3}{7\pi^{3}}(-2E)^{7/2} ,
  \label{eq:F_q=0}
\end{equation}

and in the extreme radially anisotropic $(q=2)$ to
\begin{equation}
  F_{2}(E)=\begin{cases}
\displaystyle{ \frac{6}{(2\pi)^{3}}(-2E-L)^{3/2}} & {\rm{if}} \quad -2 E\leq L^{2} ,\\
0 &{\rm{if}} \quad - 2 E\geq L^{2} .
\end{cases}
  \label{eq:F_q=2}
\end{equation}

When $-E \leq 0$ or $L \leq 0$ then $\Fq(E,L) = 0$.

\section{Isochrone model}
\label{sec:Isochrone}

The isochronous model is associated with the gravitationnal potential

\begin{equation}
  \psi(r) = - \frac{GM}{b+\sqrt{b^{2}+r^{2}}} = \frac{2 \Eo}{1+\sqrt{1+x^{2}}}
  \label{eq:IsoPotential}
\end{equation}
where $x=r/b$ and $\Eo=-GM/(2b)$.

We consider the orbital plane of the motion. Within it, we can describe the motion by its hamiltonian $H$ and its actions $\bJ = (\Jr,L)$

\begin{equation}
  H(\bJ) = - \frac{(GM)^{2}}{2 \bigg[\Jr + \frac{1}{2} \bigg(L+\sqrt{L^{2}+4GMb}\bigg)\bigg]^{2}}
  \label{eq:HamiltionianIso}
\end{equation}

From this, we can obtain a closed expression for $\Jr$

\begin{equation}
  \Jr (E,L)= \frac{GM}{\sqrt{-2E}} - \frac{1}{2} \bigg(L+\sqrt{L^{2}+4GMb}\bigg)
  \label{eq:Jr_Iso}
\end{equation}

from the generic radial action

\begin{equation}
  \Jr (E,L)= \frac{1}{\pi} \int_{\rmin}^{\rmax} \vr(r) \rd r =  \frac{1}{\pi} \int_{\rmin}^{\rmax} \sqrt{2(E-\psieff(r,L))} \rd r .
  \label{eq:Jr_Generic}
\end{equation}

From the generic definition $\rd E = \Omega_{1} \rd \Jr + \Omega_{2} \rd L$, which yields equivalently $\rd \Jr = (1/\Omega_{1}) \rd E - (\Omega_{2}/\Omega_{1}) \rd L$, we obtain

\begin{align*}
  \frac{2\pi}{\Omega_{1}} &= \int_{\rmin}^{\rmax} \frac{\rd r}{\vr(r)} = T \\
  \frac{\Omega_{2}}{\Omega_{1}} &= \frac{1}{\pi} \int_{\rmin}^{\rmax} \frac{L \rd r}{r^{2} \vr(r)} = \frac{\Theta}{2\pi}
\end{align*}

where $T$ is the radial period and $\Theta$ is the apsidal angle. In particular, for the isochronous potential,

\begin{align*}
  \Omega_{1} (E,L)&= \omega(E) \Omega_{o} \\
  \Omega_{2} (E,L)&= \eta(L) \omega(E) \Omega_{o} ,
\end{align*}

where $\omega(E) = (E/\Eo)^{3/2}$, $\Omega_{o}=\sqrt{GM/b^{3}}$ and $\eta(L)=\Omega_{2}/\Omega_{1}=(1/2)(1+L/\sqrt{L^{2}+4GMb})$.

The angles associated to the actions are (cf. main.pdf Fouvry eq (A3) : mistake on denominator: $r$ instead of $r^{2}$?)

\begin{align*}
  \theta_{1} &= \int_{\rmin}^{r(\theta_{1})} \frac{\Omega_{1}}{\vr(r)} \rd r \\
  \theta_{2} - \varphi &= \int_{\rmin}^{r(\theta_{1})} \frac{\Omega_{2} - L/r^{2}}{\vr(r)} \rd r,
  \end{align*}
where $\varphi$ is the angle from the ascending node to the current location
of the particle along the orbital motion.



\begin{appendices}

\section{Local diffusion coefficients}
\label{app:LocDiffCoeffs_Computation}
Consider a fixed, arbitrary coordinate system when we let $\e1$ be the z-axis and let $\e2$ and $\e3$ be arbitrary basis vector in the orthogonal plane. Let $\br = (r,\theta,\phi)$ such that
\begin{equation}
\begin{array}{ccl}
 r_{1} & =& \displaystyle{r\cos\theta} ,\\
  
 r_{2} & =&\displaystyle{r\sin\theta\cos\phi} ,\\

 r_{3} &=& \displaystyle{r\sin\theta\sin\phi} .
\end{array}
\label{eq:r_coord}
\end{equation}
and letting $\bv=(v_{1},v_{2},v_{3})$ be the velocity cartesian coordinates. Then
\begin{equation}
\begin{array}{cclcl}
 \vr &=& \bv \cdot\hr &=& \displaystyle{v_{1}\cos\theta+v_{2}\sin\theta\cos\phi+v_{3}\sin\theta\sin\phi} ,\\

 \vt^{2} &=& v^{2}-\vr^{2} &=& \displaystyle{v^{2}-(v_{1}\cos\theta+v_{2}\sin\theta\cos\phi+v_{3}\sin\theta\sin\phi)} .
\end{array}
\label{eq:vRadTan_coord}
\end{equation}

Let $h(\br,\bv)=h(r,\vr,\vt)$. Note that
${\partial r}/{\partial v_{i}}=0$. Thus
\begin{equation}
\frac{\partial h}{\partial v_{1}}=\frac{\partial \vr}{\partial v_{1}}\frac{\partial h}{\partial \vr}+\frac{\partial \vt}{\partial v_{1}}\frac{\partial h}{\partial \vt}
\label{eq:partial1_h}
\end{equation}

We have, (at fixed $\br$, i.e. fixed  $r,\theta,\phi$),
\begin{equation}
\begin{array}{cclcccl}
 \displaystyle{\frac{\partial\vr}{\partial v_{1}}}&=& \displaystyle{\cos\theta} &;\quad& \displaystyle{\frac{\partial \vt}{\partial v_{1}}} &=& \displaystyle{\frac{v_{1}-\vr\cos\theta}{\vt}},\\


 \displaystyle{\frac{\partial\vr}{\partial v_{2}}}&=& \displaystyle{\sin\theta \cos\phi} &;\quad& \displaystyle{\frac{\partial \vt}{\partial v_{2}}} &=& \displaystyle{\frac{v_{2}-\vr\sin\theta\cos\phi}{\vt}}, \\

 \displaystyle{\frac{\partial\vr}{\partial v_{3}}}&=& \displaystyle{\sin\theta \sin\phi} &;\quad& \displaystyle{\frac{\partial \vt}{\partial v_{3}}} &=& \displaystyle{\frac{v_{3}-\vr\sin\theta\sin\phi}{\vt}} .
 
\end{array}
\label{eq:dvdv1}
\end{equation}

In the special coordinate system where $\e1=\hv$ and $\e2$
is the projection of $\hr$ on the equatorial plane ($\phi=0$),
we have that $\Delta v_{1}=\dvPar$ and $\Delta v_{2}^{2}+\Delta v_{3}^{2}=\dvPerp^{2}$,
meaning that

\begin{equation}
\begin{array}{ccl}
  \dvParAvrLoc&=& \displaystyle{\langle\Delta v_{1}\rangle} ,\\

  \dvParSqAvrLoc&=& \displaystyle{\langle(\Delta v_{1})^{2}\rangle} ,\\

  \dvPerpSqAvrLoc &=& \displaystyle{\langle(\Delta v_{2})^{2}\rangle+\langle(\Delta v_{3})^{2}\rangle} .
\end{array}
\label{eq:SpecialCoordSys_LocDiffCoeffs}
\end{equation}

In that system, we have that $v_{1}=v$, $v_{2}=v_{3}=0$ and $\phi=0$. We
also have that $\cos\theta=\vr/v$ because $\theta$ is the angle
between $\hr$ and $(Oz)=\e1=\hv$, and $\vr$ is
the orthogonal projection of $\bv$ on $\hr$. For
the same reason, $\sin\theta=\vt/v$. Therefore, in that special coordinate
system:
\begin{equation}
\frac{\partial \vr}{\partial v_{1}}=\frac{\vr}{v};\quad\frac{\partial \vt}{\partial v_{1}}=\frac{v-\vr^{2}/v}{\vt}=\frac{v^{2}-\vr^{2}}{\vt v}=\frac{\vt^{2}}{\vt v}=\frac{\vt}{v}
\label{eq:SpecialCoord_dvd1}
\end{equation}
and we have
\begin{equation}
\frac{\partial h}{\partial v_{1}}=\frac{\vr}{v}\frac{\partial h}{\partial \vr}+\frac{\vt}{v}\frac{\partial h}{\partial \vt}
\label{eq:SpecialCoord_dhdv1}
\end{equation}

As for second order derivatives, we must compute ${\partial^{2}g}/{\partial v_{1}^{2}}$, ${\partial^{2}g}/{\partial v_{2}^{2}}$ and ${\partial^{2}g}/{\partial v_{3}^{2}}$. Let us compute those in an arbitrary coordinate system.

\begin{equation}
\begin{array}{ccl}
  \displaystyle{\frac{\partial^{2}g}{\partial v_{1}^{2}}}&=& \displaystyle{\frac{\partial}{\partial v_{1}}\left(\frac{\partial \vr}{\partial v_{1}}\right)\frac{\partial g}{\partial \vr}+\left(\frac{\partial \vr}{\partial v_{1}}\right)^{2}\frac{\partial^{2}g}{\partial \vr^{2}}+\left(\frac{\partial \vr}{\partial v_{1}}\frac{\partial \vt}{\partial v_{1}}\right)\frac{\partial^{2}g}{\partial \vt\partial \vr}} ,\\

  {} &+& \displaystyle{\frac{\partial}{\partial v_{1}}\left(\frac{\partial \vt}{\partial v_{1}}\right)\frac{\partial g}{\partial \vt}+\left(\frac{\partial \vt}{\partial v_{1}}\right)^{2}\frac{\partial^{2}g}{\partial \vt^{2}}+\left(\frac{\partial \vt}{\partial v_{1}}\frac{\partial \vr}{\partial v_{1}}\right)\frac{\partial^{2}g}{\partial \vt\partial \vr}} .
\end{array}
\label{eq:d2gdv12_Arbitrary}
\end{equation}

Its coefficients are
\begin{equation}
\begin{array}{ccl}
  \displaystyle{\frac{\partial}{\partial v_{1}}\left(\frac{\partial \vr}{\partial v_{1}}\right)}&=& \displaystyle{0} ,\\
  \displaystyle{\left(\frac{\partial \vr}{\partial v_{1}}\right)^{2}\frac{\partial^{2}g}{\partial \vr^{2}}}&=& \displaystyle{\cos^{2}\theta\frac{\partial^{2}g}{\partial \vr^{2}}} ,\\
  \displaystyle{\left(\frac{\partial \vr}{\partial v_{1}}\frac{\partial \vt}{\partial v_{1}}\right)\frac{\partial^{2}g}{\partial \vt\partial \vr}}&=& \displaystyle{\cos\theta\left(\frac{v_{1}-\vr\cos\theta}{\vt}\right)\frac{\partial^{2}g}{\partial \vt\partial \vr}} ,\\
  \displaystyle{\frac{\partial}{\partial v_{1}}\left(\frac{\partial \vt}{\partial v_{1}}\right)\frac{\partial g}{\partial \vt}}&=& \displaystyle{\cos\theta\left(\frac{\sin^{2}\theta \vt-(v_{1}-\vr\cos\theta)\frac{v_{1}-\vr\cos\theta}{\vt}}{\vt^{2}}\right)\frac{\partial g}{\partial \vt}} ,\\
 

  \displaystyle{\left(\frac{\partial \vt}{\partial v_{1}}\right)^{2}\frac{\partial^{2}g}{\partial \vt^{2}}}&=& \displaystyle{\left(\frac{v_{1}-\vr\cos\theta}{\vt}\right)^{2}\frac{\partial^{2}g}{\partial \vt^{2}}} ,
\end{array}
\label{eq:d2gdv12_Coeffs_Arbitrary}
\end{equation}
which in the special coordinate system yields

\begin{equation}
\begin{array}{ccl}
  \displaystyle{\frac{\partial}{\partial v_{1}}\left(\frac{\partial \vr}{\partial v_{1}}\right)}&=& \displaystyle{0} ,\\
  \displaystyle{\left(\frac{\partial \vr}{\partial v_{1}}\right)^{2}\frac{\partial^{2}g}{\partial \vr^{2}}}&=& \displaystyle{\left(\frac{\vr}{v}\right)^{2}\frac{\partial^{2}g}{\partial \vr^{2}}} ,\\
  \displaystyle{\left(\frac{\partial \vr}{\partial v_{1}}\frac{\partial \vt}{\partial v_{1}}\right)\frac{\partial^{2}g}{\partial \vt\partial \vr}}&=& \displaystyle{\left(\frac{\vr\vt}{v^{2}}\right)\frac{\partial^{2}g}{\partial \vt\partial \vr}} ,\\
  \displaystyle{\frac{\partial}{\partial v_{1}}\left(\frac{\partial \vt}{\partial v_{1}}\right)\frac{\partial g}{\partial \vt}}&=& \displaystyle{0} ,\\
 
  \displaystyle{\left(\frac{\partial \vt}{\partial v_{1}}\right)^{2}\frac{\partial^{2}g}{\partial \vt^{2}}}&=& \displaystyle{\left(\frac{\vt}{v}\right)^{2}\frac{\partial^{2}g}{\partial \vt^{2}}} ,
\end{array}
\label{eq:d2gdv12_Coeffs_Special}
\end{equation}

hence
\begin{equation}
  \frac{\partial^{2}g}{\partial v_{1}^{2}}  =\left(\frac{\vr}{v}\right)^{2}\frac{\partial^{2}g}{\partial \vr^{2}}+\frac{2\vr\vt}{v^{2}}\frac{\partial^{2}g}{\partial \vt\partial \vr}+\left(\frac{\vt}{v}\right)^{2}\frac{\partial^{2}g}{\partial \vt^{2}}.
  \label{eq:d2gdv12_Special}
\end{equation}

~

For the $v_{2}$ partial derivative, we have:

\begin{equation}
\begin{array}{ccl}
  \displaystyle{\frac{\partial^{2}g}{\partial v_{2}^{2}}}&=& \displaystyle{\frac{\partial}{\partial v_{2}}\left(\frac{\partial \vr}{\partial v_{2}}\right)\frac{\partial g}{\partial \vr}+\left(\frac{\partial \vr}{\partial v_{2}}\right)^{2}\frac{\partial^{2}g}{\partial \vr^{2}}+\left(\frac{\partial \vr}{\partial v_{2}}\frac{\partial \vt}{\partial v_{2}}\right)\frac{\partial^{2}g}{\partial \vt\partial \vr}} ,\\

  {} &+& \displaystyle{\frac{\partial}{\partial v_{2}}\left(\frac{\partial \vt}{\partial v_{2}}\right)\frac{\partial g}{\partial \vt}+\left(\frac{\partial \vt}{\partial v_{2}}\right)^{2}\frac{\partial^{2}g}{\partial \vt^{2}}+\left(\frac{\partial \vt}{\partial v_{2}}\frac{\partial \vr}{\partial v_{2}}\right)\frac{\partial^{2}g}{\partial \vt\partial \vr}} .
\end{array}
\label{eq:d2gdv22_Arbitrary}
\end{equation}

Its coefficients are
\begin{equation}
\begin{array}{ccl}
  \displaystyle{\frac{\partial}{\partial v_{2}}\left(\frac{\partial \vr}{\partial v_{2}}\right)}&=& \displaystyle{0} ,\\
  \displaystyle{\left(\frac{\partial \vr}{\partial v_{2}}\right)^{2}\frac{\partial^{2}g}{\partial \vr^{2}}}&=& \displaystyle{\sin^{2}\theta\cos^{2}\phi\frac{\partial^{2}g}{\partial \vr^{2}}} ,\\
  \displaystyle{\left(\frac{\partial \vr}{\partial v_{2}}\frac{\partial \vt}{\partial v_{2}}\right)\frac{\partial^{2}g}{\partial \vt\partial \vr}}&=& \displaystyle{\sin\theta\cos\phi\left(\frac{v_{2}-\vr\sin\theta\cos\phi}{\vt}\right)\frac{\partial^{2}g}{\partial \vt\partial \vr}} ,\\
  \displaystyle{\frac{\partial}{\partial v_{2}}\left(\frac{\partial \vt}{\partial v_{2}}\right)\frac{\partial g}{\partial \vt}}&=& \displaystyle{\left(\frac{(1-\sin^{2}\theta\cos^{2}\phi)\vt-(v_{2}-\vr\sin\theta\cos\phi)\frac{v_{2}-\vr\sin\theta\cos\phi}\vt}{\vt^{2}}\right)\frac{\partial g}{\partial \vt}} ,\\
 
  \displaystyle{\left(\frac{\partial \vt}{\partial v_{2}}\right)^{2}\frac{\partial^{2}g}{\partial \vt^{2}}}&=& \displaystyle{\left(\frac{v_{2}-\vr\sin\theta\cos\phi}{\vt}\right)^{2}\frac{\partial^{2}g}{\partial \vt^{2}}} ,
\end{array}
\label{eq:d2gdv22_Coeffs_Arbitrary}
\end{equation}
which in the special coordinate system yields

\begin{equation}
\begin{array}{ccl}
  \displaystyle{\frac{\partial}{\partial v_{2}}\left(\frac{\partial \vr}{\partial v_{2}}\right)}&=& \displaystyle{0} ,\\
  \displaystyle{\left(\frac{\partial \vr}{\partial v_{2}}\right)^{2}\frac{\partial^{2}g}{\partial \vr^{2}}}&=& \displaystyle{\left(\frac{\vt}{v}\right)^{2}\frac{\partial^{2}g}{\partial \vr^{2}}} ,\\
  \displaystyle{\left(\frac{\partial \vr}{\partial v_{2}}\frac{\partial \vt}{\partial v_{2}}\right)\frac{\partial^{2}g}{\partial \vt\partial \vr}}&=& \displaystyle{\left(-\frac{\vr \vt}{v^{2}}\right)\frac{\partial^{2}g}{\partial \vt\partial \vr}} ,\\
  \displaystyle{\frac{\partial}{\partial v_{2}}\left(\frac{\partial \vt}{\partial v_{2}}\right)\frac{\partial g}{\partial \vt}}&=& \displaystyle{0} ,\\
 
  \displaystyle{\left(\frac{\partial \vt}{\partial v_{2}}\right)^{2}\frac{\partial^{2}g}{\partial \vt^{2}}}&=& \displaystyle{\left(\frac{\vr}{v}\right)^{2}\frac{\partial^{2}g}{\partial \vt^{2}}} ,
\end{array}
\label{eq:d2gdv22_Coeffs_Special}
\end{equation}

hence
\begin{equation}
  \frac{\partial^{2}g}{\partial v_{2}^{2}}  =\left(\frac{\vt}{v}\right)^{2}\frac{\partial^{2}g}{\partial \vr^{2}}-\frac{2\vr\vt}{v^{2}}\frac{\partial^{2}g}{\partial \vt\partial \vr}+\left(\frac{\vr}{v}\right)^{2}\frac{\partial^{2}g}{\partial \vt^{2}}.
   \label{eq:d2gdv22_Special}
\end{equation}

~

For the $v_{3}$ partial derivative, we have :

\begin{equation}
\begin{array}{ccl}
  \displaystyle{\frac{\partial^{2}g}{\partial v_{3}^{2}}}&=& \displaystyle{\frac{\partial}{\partial v_{3}}\left(\frac{\partial \vr}{\partial v_{3}}\right)\frac{\partial g}{\partial \vr}+\left(\frac{\partial \vr}{\partial v_{3}}\right)^{2}\frac{\partial^{2}g}{\partial \vr^{2}}+\left(\frac{\partial \vr}{\partial v_{3}}\frac{\partial \vt}{\partial v_{3}}\right)\frac{\partial^{2}g}{\partial \vt\partial \vr}} ,\\

  {} &+& \displaystyle{\frac{\partial}{\partial v_{3}}\left(\frac{\partial \vt}{\partial v_{3}}\right)\frac{\partial g}{\partial \vt}+\left(\frac{\partial \vt}{\partial v_{3}}\right)^{2}\frac{\partial^{2}g}{\partial \vt^{2}}+\left(\frac{\partial \vt}{\partial v_{3}}\frac{\partial \vr}{\partial v_{3}}\right)\frac{\partial^{2}g}{\partial \vt\partial \vr}} .
\end{array}
\label{eq:d2gdv32_Arbitrary}
\end{equation}

Its coefficients are
\begin{equation}
\begin{array}{ccl}
  \displaystyle{\frac{\partial}{\partial v_{3}}\left(\frac{\partial \vr}{\partial v_{3}}\right)}&=& \displaystyle{0} ,\\
  \displaystyle{\left(\frac{\partial \vr}{\partial v_{3}}\right)^{2}\frac{\partial^{2}g}{\partial \vr^{2}}}&=& \displaystyle{\sin^{2}\theta\sin^{2}\phi\frac{\partial^{2}g}{\partial \vr^{2}}} ,\\
  \displaystyle{\left(\frac{\partial \vr}{\partial v_{3}}\frac{\partial \vt}{\partial v_{3}}\right)\frac{\partial^{2}g}{\partial \vt\partial \vr}}&=& \displaystyle{\sin\theta\sin\phi\left(\frac{v_{3}-\vr\sin\theta\sin\phi}{\vt}\right)\frac{\partial^{2}g}{\partial \vt\partial \vr}} ,\\
  \displaystyle{\frac{\partial}{\partial v_{2}}\left(\frac{\partial \vt}{\partial v_{2}}\right)\frac{\partial g}{\partial \vt}}&=& \displaystyle{\left(\frac{(1-\sin^{2}\theta\sin^{2}\phi)\vt-(v_{3}-\vr\sin\theta\sin\phi)\frac{v_{3}-\vr\sin\theta\sin\phi}{\vt}}{\vt^{2}}\right)\frac{\partial g}{\partial \vt}} ,\\
 
  \displaystyle{\left(\frac{\partial \vt}{\partial v_{3}}\right)^{2}\frac{\partial^{2}g}{\partial \vt^{2}}}&=& \displaystyle{\left(\frac{v_{3}-\vr\sin\theta\sin\phi}{\vt}\right)^{2}\frac{\partial^{2}g}{\partial \vt^{2}}} ,
\end{array}
\label{eq:d2gdv32_Coeffs_Arbitrary}
\end{equation}
which in the special coordinate system yields

\begin{equation}
\begin{array}{ccl}
  \displaystyle{\frac{\partial}{\partial v_{3}}\left(\frac{\partial \vr}{\partial v_{3}}\right)}&=& \displaystyle{0} ,\\
  \displaystyle{\left(\frac{\partial \vr}{\partial v_{3}}\right)^{2}\frac{\partial^{2}g}{\partial \vr^{2}}}&=& \displaystyle{0} ,\\
  \displaystyle{\left(\frac{\partial \vr}{\partial v_{3}}\frac{\partial \vt}{\partial v_{3}}\right)\frac{\partial^{2}g}{\partial \vt\partial \vr}}&=& \displaystyle{0} ,\\
  \displaystyle{\frac{\partial}{\partial v_{3}}\left(\frac{\partial \vt}{\partial v_{3}}\right)\frac{\partial g}{\partial \vt}}&=& \displaystyle{\left(\frac{1}{\vt}\right)\frac{\partial g}{\partial \vt}} ,\\
 
  \displaystyle{\left(\frac{\partial \vt}{\partial v_{3}}\right)^{2}\frac{\partial^{2}g}{\partial \vt^{2}}}&=& \displaystyle{0} ,
\end{array}
\label{eq:d2gdv32_Coeffs_Special}
\end{equation}

hence
\begin{equation}
  \frac{\partial^{2}g}{\partial v_{3}^{2}}  = \frac{1}{\vt}\frac{\partial g}{\partial \vt} .
   \label{eq:d2gdv32_Special}
\end{equation}

\section{From anisotropy to isotropy}
\label{app:Aniso_To_Iso}
From the anisotropic Rosenbluth formulae, we should recover the isotropic formulae. Let $h(v_{r},v_{t})=h(v)$ where $v^{2}=\vr^{2}+\vt^{2}$. Then the $\dvParAvrLoc$ partial derivatives yield

\begin{equation}
\frac{\vr}{v}\frac{\partial h}{\partial \vr}+\frac{\vt}{v}\frac{\partial h}{\partial \vt}=\frac{\vr}{v}\frac{\partial v}{\partial \vr}h'+\frac{\vt}{v}\frac{\partial v}{\partial \vt}h'=\frac{\vr^{2}}{v^{2}}h'+\frac{\vt^{2}}{v^{2}}h'=h'
\label{eq:AniToIso_d1}
\end{equation}

The $\dvParSqAvrLoc$ and $\dvPerpSqAvrLoc$ partial derivatives yield

\begin{equation}
  \begin{array}{ccl}
\displaystyle{\frac{\partial^{2}g}{\partial \vr^{2}}}& =&\displaystyle{\frac{\partial}{\partial \vr}(\frac{\partial v}{\partial \vr}g'(v))=\frac{\partial}{\partial\vr}(\frac{\vr}{v}g'(v))=\frac{v-\vr^{2}/v}{v^{2}}g'(v)+\frac{\vr}{v}\frac{\partial v}{\partial \vr}g''(v)}\\
     {}& =&\displaystyle{\frac{\vt^{2}}{v^{3}}g'(v)+\frac{\vr^{2}}{v^{2}}g''(v)}\\

\displaystyle{\frac{\partial^{2}g}{\partial \vt\partial \vr}}&=&\displaystyle{\frac{\partial}{\partial\vt}(\frac{\partial v}{\partial \vr}g')=\frac{\partial}{\partial \vt}(\frac{\vr}{v}g')=-\frac{\vr\vt/v}{v^{2}}g'+\frac{\vr}{v}\frac{\partial v}{\partial\vt}g''}\\
     {}& =&\displaystyle{-\frac{\vr\vt}{v^{3}}g'+\frac{\vr\vt}{v^{2}}g'}'\\

\displaystyle{\frac{\partial^{2}g}{\partial \vt^{2}}}&=&\displaystyle{\displaystyle{\frac{\partial}{\partial \vt}(\frac{\partial v}{\partial \vt}g')}=\displaystyle{\frac{\partial}{\partial \vt}(\frac{\vt}{v}g')}=\displaystyle{\frac{v-\vt^{2}/v}{v^{2}}g'+\frac{\vt}{v}\frac{\partial v}{\partial \vt}g'}}\\
{}  &=&\displaystyle{\displaystyle{\frac{\vr^{2}}{v^{3}}g'+\frac{\vt^{2}}{v^{2}}g''}}\\
 \displaystyle{\frac{\partial g}{\partial \vt}}&=&\displaystyle{\frac{\partial v}{\partial \vt}g'=\frac{\vt}{v}g'} .           
  \end{array}
  \label{eq:AniToIso_d2}
\end{equation}

Therefore, after doing the calculations, 
hence
\begin{equation}
  \left(\frac{\vr}{v}\right)^{2}\frac{\partial^{2}g}{\partial \vr^{2}}+\frac{2\vr\vt}{v^{2}}\frac{\partial^{2}g}{\partial \vt\partial\vr}+\left(\frac{\vt}{v}\right)^{2}\frac{\partial^{2}g}{\partial \vt^{2}} =g''
  \label{eq:Iso_g''}
\end{equation}
and
\begin{equation}
  \left(\frac{\vt}{v}\right)^{2}\frac{\partial^{2}g}{\partial \vr^{2}}-\frac{2\vr\vt}{v^{2}}\frac{\partial^{2}g}{\partial\vt\partial \vr}+\left(\frac{\vr}{v}\right)^{2}\frac{\partial^{2}g}{\partial \vt^{2}}+\frac{1}{\vt}\frac{\partial g}{\partial \vt} =\frac{2}{v}g'
  \label{eq:Iso_g'}
\end{equation}

\section{Test star velocity components}
\label{app:Test_star_velocity}

We have to do an integration over velocity space to compute the Rosenbluth potential and its derivatives. To that end, we use spherical coordinate by fixing $(Oz) = \hr$ and letting $(Ox) \propto \bvt$. Then $\vx=\vt$, $\vy=0$ and $\vz=\vr$. Since
\begin{equation}
\begin{array}{ccl}
  V_{0 \rx} & =&\displaystyle{V_{0}\sin\theta\cos\phi} ,\\

  V_{0 \ry} &=& \displaystyle{V_{0}\sin\theta\sin\phi} , \\

  V_{0 \rz} & =& \displaystyle{V_{0}\cos\theta} ,
\end{array}
\label{eq:V0_coord}
\end{equation}
then
\begin{equation}
\begin{array}{ccl}
 \vax & =&\displaystyle{\vt - V_{0}\sin\theta\cos\phi} ,\\

  \vay &=& \displaystyle{-V_{0}\sin\theta\sin\phi} , \\

  \vaz & =& \displaystyle{\vr - V_{0}\cos\theta} ,
\end{array}
\label{eq:va_coord}
\end{equation}
and therefore
\begin{equation}
  \begin{array}{ccl}
  \var & =&\displaystyle{\vr-V_{0}\cos\theta} ,\\

  \vat^{2} & =& \displaystyle{(\vt-V_{0}\sin\theta\cos\phi)^{2}+(V_{0}\sin\theta\sin\phi)^{2}} .
  \end{array}
  \label{eq:va_r_t}
\end{equation}
The associated energy and angular momentum are
\begin{equation}
  \begin{array}{ccl}
  \Ea & =&\displaystyle{\psi(r)-\frac{1}{2}\left[v^{2}+V_{0}^{2}-2V_{0}\left(\vr\cos\theta + \vt\sin\theta\cos\phi\right)\right]} ,\\

  \La & =& \displaystyle{r\left(\vt^{2}+V_{0}^{2}\sin^{2}\theta-2\vt V_{0}\sin\theta\cos\phi\right)^{1/2}} .
  \end{array}
  \label{eq:Ea_La}
\end{equation}

\section{Velocity-derivatives of the DF $F(E,L)$}
\label{app:fq_derivatives}

First, we compute the velocity dependency of the energy and the angular momentum

\begin{equation}
  \begin{array}{cclcccl}
  \displaystyle{\frac{\partial\Ea}{\partial \vr}} & =&\displaystyle{-\vr + V_{0} \cos\theta}&;\quad&  \displaystyle{\frac{\partial\Ea}{\partial \vt}} & =&\displaystyle{-\vt + V_{0}\sin\theta \cos\phi},\\

  \displaystyle{\frac{\partial\La}{\partial \vr}} & =&\displaystyle{
    0}&;\quad&  \displaystyle{\frac{\partial\La}{\partial \vt}} & =&\displaystyle{\frac{r}{\La} (\vt-V_{0}\sin\theta\cos\phi)} .
 
  \end{array}
  \label{eq:Ea_La}
\end{equation}
Then we just apply the chain rule as many times as we need to to obtain the desire formulae.

\section{Partial derivatives of $\Fq$ (Plummer)}
\label{app:Fq_derivatives}
We will need the derivatives of $\mH$, which are


\begin{equation}
  \mH'(a,b,c,d;x)=\begin{cases}
  \begin{array}{l}
    \displaystyle{\frac{\Gamma(a+b)x^{a-1}}{\Gamma(c-a)\Gamma(a+d)}\bigg[a\HG(a+b,1+a-c,a+d;x)} \\
      \displaystyle{+\frac{(a+b)(1+a-c)}{a+d}x \HG(a+b+1,a-c+2,a+d+1;x)\bigg]}
  \end{array} & {\rm{if}} \quad x\leq1 , \\
  {}&{}\\
  \begin{array}{l}
    \displaystyle{\frac{\Gamma(a+b)x^{-b-1}}{\Gamma(d-b)\Gamma(b+c)}\bigg[(-b)\HG(a+b,1+b-d,b+c;\frac{1}{x})} \\
      \displaystyle{-\frac{(a+b)(1+b-d)}{b+c}x^{-1}\HG(a+b+1,b-d+2,b+c+1;\frac{1}{x})\bigg]}
    \end{array} &{\rm{if}} \quad x\geq1 ,
\end{cases}
\label{eq:dHdx}
\end{equation}

and

\begin{equation}
  \mH''(a,b,c,d;x)=\begin{cases}
  \begin{array}{l}
    \displaystyle{\frac{\Gamma(a+b)x^{a-2}}{\Gamma(c-a)\Gamma(a+d)}\bigg[a(a-1)\HG(a+b,1+a-c,a+d;x)} \\
        \displaystyle{+\frac{2a(a+b)(1+a-c)}{a+d}x\HG(a+b+1,a-c+2,a+d+1;x)}\\
        \displaystyle{+\frac{(a+b)(1+a-c)}{a+d}\frac{(a+b+1)(a-c+2)}{a+d+1}x^{2}} \\
        \displaystyle{\times \HG(a+b+2,a-c+3,a+d+2;x)\bigg]}
  \end{array} & {\rm{if}} \quad x\leq1 , \\
  {}&{}\\
  \begin{array}{l}
    \displaystyle{\frac{\Gamma(a+b)x^{-b-2}}{\Gamma(d-b)\Gamma(b+c)}\bigg[b(b+1)\HG(a+b,1+b-d,b+c;\frac{1}{x})} \\
      \displaystyle{+\frac{(2b+2)(a+b)(1+b-d)}{b+c}x^{-1}\HG(a+b+1,b-d+2,b+c+1;\frac{1}{x})}\\
      \displaystyle{+\frac{(a+b)(1+b-d)}{b+c}\frac{(a+b+1)(b-d+2)}{b+c+1}x^{-2}} \\
      \displaystyle{\times \HG(a+b+2,b-d+3,b+c+2;\frac{1}{x})\bigg]}
    \end{array} &{\rm{if}} \quad x\geq1 ,
\end{cases}
\label{eq:d2Hdx2}
\end{equation}

Then, for $q \notin \{0,2\}$, we have for first-order

\begin{equation}
  \begin{array}{ccl}
    \displaystyle{\frac{\partial \Fq}{\partial E}(E,L)}&=&\displaystyle{\frac{3\Gamma(6-q)E^{3/2-q}}{2(2\pi)^{5/2}\Gamma(q/2)}\left[E\left(\frac{7}{2}-q\right)\mH(0,\frac{q}{2},\frac{9}{2}-q,1;\frac{L^{2}}{2E})-\frac{L^{2}}{2}\mH'(0,\frac{q}{2},\frac{9}{2}-q,1;\frac{L^{2}}{2E})\right]} ,\\

    \displaystyle{\frac{\partial \Fq}{\partial L}(E,L)} &=& \displaystyle{\frac{3\Gamma(6-q)}{2(2\pi)^{5/2}\Gamma(q/2)}E^{5/2-q}L\mH'(0,\frac{q}{2},\frac{9}{2}-q,1;\frac{L^{2}}{2E})} .
    \end{array}
\label{eq:d1F}
\end{equation}

For second order, we have

\begin{equation}
  \begin{array}{ccl}
    \displaystyle{\frac{\partial^{2}\Fq}{\partial E^{2}}(E,L)}&=&\displaystyle{\frac{3\Gamma(6-q)E^{3/2-q}}{2(2\pi)^{5/2}\Gamma(q/2)}\bigg[\left(\frac{7}{2}-q\right)\left(\frac{5}{2}-q\right)\mH(0,\frac{q}{2},\frac{9}{2}-q,1;\frac{L^{2}}{2E})} \\
      {}&-& \displaystyle{\left(5-2q\right)\frac{L^{2}}{2E}\mH'(0,\frac{q}{2},\frac{9}{2}-q,1;\frac{L^{2}}{2E})+\frac{L^{4}}{4E^{2}}\mH''(0,\frac{q}{2},\frac{9}{2}-q,1;\frac{L^{2}}{2E})\bigg]} ,\\

    \displaystyle{\frac{\partial^{2}\Fq}{\partial E\partial L}(E,L)} &=& \displaystyle{\frac{3\Gamma(6-q)LE^{1/2-q}}{2(2\pi)^{5/2}\Gamma(q/2)}\bigg[\left(\frac{5}{2}-q\right)E\mH'(0,\frac{q}{2},\frac{9}{2}-q,1;\frac{L^{2}}{2E})} \\
      {}&-& \displaystyle{\frac{L^{2}}{2}\mH''(0,\frac{q}{2},\frac{9}{2}-q,1;\frac{L^{2}}{2E})\bigg]} ,\\
    \displaystyle{\frac{\partial^{2}F_{q}}{\partial L^{2}}(E,L)}&=&\displaystyle{\frac{3\Gamma(6-q)E^{3/2-q}}{2(2\pi)^{5/2}\Gamma(q/2)}\left[E\mH'(0,\frac{q}{2},\frac{9}{2}-q,1;\frac{L^{2}}{2E})+L^{2}\mH''(0,\frac{q}{2},\frac{9}{2}-q,1;\frac{L^{2}}{2E})\right]} .
    \end{array}
\label{eq:d2F}
\end{equation}

For the isotropic case $q=0$, the derivatives are

\begin{equation}
  \begin{array}{ccl}
    \displaystyle{\frac{\partial F_{0}}{\partial E}(E)}&=&\displaystyle{\frac{3}{\pi^{3}}(2E)^{5/2}} ,\\

    \displaystyle{\frac{\partial^{2} F_{0}}{\partial E^{2}}(E)} &=& \displaystyle{\frac{15}{\pi^{3}}(2E)^{3/2}} .
    \end{array}
\label{eq:dF0}
\end{equation}
while in the highly-radially anisotropic case $q=2$, for $L^{2} \leq 2E$ (null if otherwise)
\begin{equation}
  \begin{array}{ccl}
    \displaystyle{\frac{\partial F_{2}}{\partial E}(E,L)}&=&\displaystyle{\frac{18}{(2\pi)^{3}}(2E-L^{2})^{1/2}} ,\\

    \displaystyle{\frac{\partial F_{0}}{\partial L}(E,L)} &=& \displaystyle{\frac{-18L}{(2\pi)^{3}}(2E-L^{2})^{1/2}} , \\
  
      \displaystyle{\frac{\partial^{2} F_{2}}{\partial E^{2}}(E,L)}&=&\displaystyle{\frac{18}{(2\pi)^{3}}(2E-L^{2})^{-1/2}} ,\\

      \displaystyle{\frac{\partial^{2} F_{0}}{\partial E \partial L}(E,L)} &=& \displaystyle{\frac{-18L}{(2\pi)^{3}}(2E-L^{2})^{-1/2}} , \\

         \displaystyle{\frac{\partial^{2} F_{0}}{\partial L^{2}}(E,L)} &=& \displaystyle{-\frac{18}{(2\pi)^{3}}(2E-L^{2})^{1/2}+\frac{18L^{2}}{(2\pi)^{3}}(2E-L^{2})^{-1/2}} .
    \end{array}
\label{eq:dF2}
\end{equation}

\section{Generating function $\Jr(E,L$)}
\label{sec:derivatives_Jr}

$\Jr(E,L)$ is a function of the form

\begin{equation}
  \Jr(E,L) = \frac{1}{\pi} \bigg(G(\rmax(E,L),E,L)-G(\rmin(E,L),E,L))\bigg)
  \label{eq:Jr_eq} ,
\end{equation}

where $\vr(\rmin,E,L)=\vr(\rmax,E,L)=0$ and

\begin{equation}
  G(x,E,L) = \int_{0}^{x} \vr(x,E,L) \rd x .
  \label{eq:Jr_eq_G}
\end{equation}

Differentiation by $E$ using chain rule and $\partial G/\partial r (x,E,L) = \vr(x,E,L)$ , yields

\begin{align*}
  \frac{\partial \Jr}{\partial E}(E,L) &= \frac{1}{\pi} \bigg( \frac{\partial G}{\partial E}(\rmin,E,L)- \frac{\partial G}{\partial E}(\rmin,E,L)\bigg)
  \label{eq:dJrdE} \\
  &= \frac{1}{\pi} \int_{\rmin(E,L)}^{\rmax(E,L)} \frac{\partial \vr}{\partial E} (r,E,L) \rd r \\
  &= - \frac{1}{\pi} \int_{\rmin(E,L)}^{\rmax(E,L)} \frac{\rd r}{\vr(r,E,L)} = -\frac{T}{2\pi} .
\end{align*}

By the same method,

\begin{align*}
  \frac{\partial \Jr}{\partial L}(E,L) &= \frac{1}{\pi} \int_{\rmin(E,L)}^{\rmax(E,L)} \frac{\partial \vr}{\partial L} (r,E,L) \rd r \\
  &= \frac{1}{\pi} \int_{\rmin(E,L)}^{\rmax(E,L)} \frac{- L \rd r }{r^{2} \vr(r,E,L)} = - \frac{\Theta}{2\pi}
\end{align*}

\section{Plummer model's orbit-averaging}
\label{sec:OrbAvrPlummer}

Consider the equation $z^{2}(x)=Y(x)-(Ex-\Lc^{2})=\Upsilon(x)$. From its definition, we have that
\begin{equation}
  Y(x) = 2r^{2}\psi(r) = x \psi(\sqrt{x/2}) = - \frac{x}{\sqrt{1+x/2}} .
  \label{eq:Y(x)_Plummer}
\end{equation}

Notice that by definition (see eq. \eqref{eq:angular_circular}), $\Upsilon(x)$ reaches its extremum at $\xc$ with $\Upsilon(\xc)=0$.

Its derivatives are
\begin{align*}
  \Upsilon'(x)&=-\frac{4+x}{\sqrt{2}(2+x)^{3/2}}-E,\\
  \Upsilon''(x)&= \frac{x+8}{2\sqrt{2}(2+x)^{5/2}}>0, 
\end{align*}
where $\Upsilon'(\xc)=0$. Therefore $\Upsilon'(x)$ is negative in $[0,\xc]$ and positive in $[\xc,+\infty[$, meaning that $\Upsilon(x)$ decreasing down to $0$ in $[0,\xc]$, then increases to infinity in $[\xc,+\infty[$.

This shows that $z^{2}=\Upsilon(x)$ has two solutions in $x$. We define $x=\varphi(z)$ as done in eq, that is, by taking the solution $x<\xc$ for $z<0$ and taking the solution $x>\xc$ for $z>0$.

By the bijection theorem $\varphi(z)$ is a continuous inverse bijection. Since $z(x)$ is $C^{1}$ with non-vanishing derivative for $x\neq\xc$, so is its inverse $\varphi(z)$. To prove that it is differentiable at $z=0$, one only has to show that a finite derivative exists at $z=0$ (mean value theorem). Let $\epsilon>0$. Then

\begin{align*}
  z(\xc+\epsilon) &= +\sqrt{\Upsilon(\xc+\epsilon)} = +\sqrt{0+\epsilon \Upsilon'(\xc)+\frac{\epsilon^{2}}{2} \Upsilon''(\xc)+o(\epsilon^{2})} =+ \epsilon\sqrt{\frac{\Upsilon''(\xc)}{2}} + o(\epsilon) ,\\
  z(\xc-\epsilon) &= -\sqrt{\Upsilon(\xc-\epsilon)} = -\sqrt{0-\epsilon \Upsilon'(\xc)+\frac{\epsilon^{2}}{2} \Upsilon''(\xc)+o(\epsilon^{2})} = -\epsilon\sqrt{\frac{\Upsilon''(\xc)}{2}} + o(\epsilon) ,
  \end{align*}
hence the left and right derivatives coincide and $z'(\xc)=\sqrt{\Upsilon''(\xc)/2}>0$, which is non-zero. This means that the inversion bijection is differentiable at $z=0$, with derivative $\varphi'(0)=\sqrt{2/\Upsilon''(\xc)}>0$.

Furthermore,
\begin{align*}
  z^{2} &= Y(x) - (E x-\Lc^{2})  ,
\end{align*}
\begin{align*}
  z^{2} &= -\frac{x}{\sqrt{1+x/2}}-E x + \Lc^{2} ,
\end{align*}
\begin{align*}
 z^{2}-\Lc^{2} &= \bigg(-\frac{1}{\sqrt{1+x/2}}-E\bigg)x ,
  \end{align*}
\begin{align*}
\frac{z^{2}-\Lc^{2}+E x}{x} &= -\frac{1}{\sqrt{1+x/2}} ,
  \end{align*}
\begin{align*}
(z^{2}-\Lc^{2}+E x)^{2}(1+x/2) &=x^{2} .
  \end{align*}

This is a degree-3 polynomial equation, with at least the two positive-real solutions of $z^{2}=\Upsilon(x)$. There are no other positive real solutions, but because it is a degree-3 polynomial equation with real coefficients and strictly more than 1 real solution, it more have a third real solution, which must be negative. Viète's formulae give us analytical expressions for those solutions.

Defining
\begin{align*}
  a &= E^{2}/2, \\
  b &= (z^{2}-\Lc^{2})E+E^{2}-1 ,\\
  c &= 2(z^{2}-\Lc^{2})E + (z^{2}-\Lc^{2})^{2}/2 ,\\
  d &= (z^{2}-\Lc^{2})^{2} .
\end{align*}

the equation becomes $a x^{3}+b x^{2}+c x+d = 0$. Setting $x=t-b/(3a)$ and
\begin{align*}
  p &= (3ac -b^{2})/(3a^{2}), \\
  q &= (2b^{3}-9abc+27a^{2}d)/(27a^{3}) ,
  \end{align*}
the equation to solve is $t^{3}+pt+q=0$, with the three roots given by

\begin{equation}
  t_{k} = 2\sqrt{-\frac{p}{3}} \cos\bigg[\frac{1}{3}\arccos\bigg(\frac{3q}{2p} \sqrt{-\frac{3}{p}}\bigg)-\frac{2\pi k}{3}\bigg] .
  \label{eq:Viete_formula_varphi(z)}
\end{equation}
One must then order the three roots, discard the negative one, and select the smaller or the bigger root depending on the sign of $z$.

Using the same method, we may also obtain an analytical expression for $\xc$, since the condition $\Upsilon'(\xc)=0$ (only one positive solution) is equivalent to the cubic equation
\begin{equation}
   2E^{2}(2+x)^{3} - (4+x)^{2} = 0 ,
  \label{eq:xcPlummer}
\end{equation}
which has only one real solution $(-1<E<0)$. Defining
\begin{align*}
  a &= E^{2}/2, \\
  b &= 12E^{2}-1 ,\\
  c &= 24E^{2}-8,\\
  d &= 16(E^{2}-1) ,
\end{align*}
and defining $p,q$ the same way, we can express the solution as
\begin{equation}
  \xc(E) = -\frac{b}{3a} + \sqrt[3]{-\frac{q}{2}+\sqrt{\frac{q^{2}}{4}+\frac{p^{3}}{27}}} + \sqrt[3]{-\frac{q}{2}-\sqrt{\frac{q^{2}}{4}+\frac{p^{3}}{27}}} .
  \label{eq:xcPlummer}
  \end{equation}


\end{appendices}

\end{document}
